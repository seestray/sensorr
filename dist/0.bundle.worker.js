!function(t){var r={};function n(e){if(r[e])return r[e].exports;var o=r[e]={i:e,l:!1,exports:{}};return t[e].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=t,n.c=r,n.d=function(t,r,e){n.o(t,r)||Object.defineProperty(t,r,{enumerable:!0,get:e})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,r){if(1&r&&(t=n(t)),8&r)return t;if(4&r&&"object"==typeof t&&t&&t.__esModule)return t;var e=Object.create(null);if(n.r(e),Object.defineProperty(e,"default",{enumerable:!0,value:t}),2&r&&"string"!=typeof t)for(var o in t)n.d(e,o,function(r){return t[r]}.bind(null,o));return e},n.n=function(t){var r=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(r,"a",r),r},n.o=function(t,r){return Object.prototype.hasOwnProperty.call(t,r)},n.p="/",n(n.s=1)}([function(t,r){var n=function(){};
/*!
 * quantize.js Copyright 2008 Nick Rabinowitz.
 * Licensed under the MIT license: http://www.opensource.org/licenses/mit-license.php
 */
/*!
 * Block below copied from Protovis: http://mbostock.github.com/protovis/
 * Copyright 2010 Stanford Visualization Group
 * Licensed under the BSD License: http://www.opensource.org/licenses/bsd-license.php
 */
if(n.prototype.getColor=function(t,r,n){return!0!==r&&!1!==r||(n=r,r=void 0),this.getPalette(t,5,r,n)[0]},n.prototype.getPalette=function(t,r){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,e=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,o=new CanvasImage(t),i=o.getImageData(),u=i.data,s=o.getPixelCount(),a=this.getPaletteFromPixels(u,s,r,n,e);return o.removeCanvas(),a},n.prototype.getPaletteFromPixels=function(t,r){for(var n,e,i,u,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,f=[],c=0;c<r;c+=a)e=t[(n=4*c)+0],i=t[n+1],u=t[n+2],t[n+3]>=125&&(e>255&&i>255&&u>255||f.push([e,i,u]));var h=o.quantize(f,s),l=h.palette();return l},!e)var e={map:function(t,r){var n={};return r?t.map(function(t,e){return n.index=e,r.call(n,t)}):t.slice()},naturalOrder:function(t,r){return t<r?-1:t>r?1:0},sum:function(t,r){var n={};return t.reduce(r?function(t,e,o){return n.index=o,t+r.call(n,e)}:function(t,r){return t+r},0)},max:function(t,r){return Math.max.apply(null,r?e.map(t,r):t)}};var o=function(){var t=5,r=8-t,n=1e3,o=.75;function i(r,n,e){return(r<<2*t)+(n<<t)+e}function u(t){var r=[],n=!1;function e(){r.sort(t),n=!0}return{push:function(t){r.push(t),n=!1},peek:function(t){return n||e(),void 0===t&&(t=r.length-1),r[t]},pop:function(){return n||e(),r.pop()},size:function(){return r.length},map:function(t){return r.map(t)},debug:function(){return n||e(),r}}}function s(t,r,n,e,o,i,u){this.r1=t,this.r2=r,this.g1=n,this.g2=e,this.b1=o,this.b2=i,this.histo=u}function a(){this.vboxes=new u(function(t,r){return e.naturalOrder(t.vbox.count()*t.vbox.volume(),r.vbox.count()*r.vbox.volume())})}function f(t,r){if(r.count()){var n=r.r2-r.r1+1,o=r.g2-r.g1+1,u=r.b2-r.b1+1,s=e.max([n,o,u]);if(1==r.count())return[r.copy()];var a,f,c,h,l=0,v=[],p=[];if(s==n)for(a=r.r1;a<=r.r2;a++){for(h=0,f=r.g1;f<=r.g2;f++)for(c=r.b1;c<=r.b2;c++)h+=t[i(a,f,c)]||0;l+=h,v[a]=l}else if(s==o)for(a=r.g1;a<=r.g2;a++){for(h=0,f=r.r1;f<=r.r2;f++)for(c=r.b1;c<=r.b2;c++)h+=t[i(f,a,c)]||0;l+=h,v[a]=l}else for(a=r.b1;a<=r.b2;a++){for(h=0,f=r.r1;f<=r.r2;f++)for(c=r.g1;c<=r.g2;c++)h+=t[i(f,c,a)]||0;l+=h,v[a]=l}return v.forEach(function(t,r){p[r]=l-t}),g(s==n?"r":s==o?"g":"b")}function g(t){var n,e,o,i,u,s=t+"1",f=t+"2",c=0;for(a=r[s];a<=r[f];a++)if(v[a]>l/2){for(o=r.copy(),i=r.copy(),u=(n=a-r[s])<=(e=r[f]-a)?Math.min(r[f]-1,~~(a+e/2)):Math.max(r[s],~~(a-1-n/2));!v[u];)u++;for(c=p[u];!c&&v[u-1];)c=p[--u];return o[f]=u,i[s]=o[f]+1,[o,i]}}}return s.prototype={volume:function(t){return this._volume&&!t||(this._volume=(this.r2-this.r1+1)*(this.g2-this.g1+1)*(this.b2-this.b1+1)),this._volume},count:function(t){var r=this.histo;if(!this._count_set||t){var n,e,o,u=0;for(n=this.r1;n<=this.r2;n++)for(e=this.g1;e<=this.g2;e++)for(o=this.b1;o<=this.b2;o++){u+=r[i(n,e,o)]||0}this._count=u,this._count_set=!0}return this._count},copy:function(){return new s(this.r1,this.r2,this.g1,this.g2,this.b1,this.b2,this.histo)},avg:function(r){var n=this.histo;if(!this._avg||r){var e,o,u,s,a=0,f=1<<8-t,c=0,h=0,l=0;for(o=this.r1;o<=this.r2;o++)for(u=this.g1;u<=this.g2;u++)for(s=this.b1;s<=this.b2;s++)a+=e=n[i(o,u,s)]||0,c+=e*(o+.5)*f,h+=e*(u+.5)*f,l+=e*(s+.5)*f;this._avg=a?[~~(c/a),~~(h/a),~~(l/a)]:[~~(f*(this.r1+this.r2+1)/2),~~(f*(this.g1+this.g2+1)/2),~~(f*(this.b1+this.b2+1)/2)]}return this._avg},contains:function(t){var n=t[0]>>r;return gval=t[1]>>r,bval=t[2]>>r,n>=this.r1&&n<=this.r2&&gval>=this.g1&&gval<=this.g2&&bval>=this.b1&&bval<=this.b2}},a.prototype={push:function(t){this.vboxes.push({vbox:t,rgb:t.avg(),count:t.count()})},palette:function(){return this.vboxes.map(function(t){return{rgb:t.rgb,count:t.count}})},size:function(){return this.vboxes.size()},map:function(t){for(var r=this.vboxes,n=0;n<r.size();n++)if(r.peek(n).vbox.contains(t))return r.peek(n).color;return this.nearest(t)},nearest:function(t){for(var r,n,e,o=this.vboxes,i=0;i<o.size();i++)((n=Math.sqrt(Math.pow(t[0]-o.peek(i).color[0],2)+Math.pow(t[1]-o.peek(i).color[1],2)+Math.pow(t[2]-o.peek(i).color[2],2)))<r||void 0===r)&&(r=n,e=o.peek(i).color);return e},forcebw:function(){var t=this.vboxes;t.sort(function(t,r){return e.naturalOrder(e.sum(t.color),e.sum(r.color))});var r=t[0].color;r[0]<5&&r[1]<5&&r[2]<5&&(t[0].color=[0,0,0]);var n=t.length-1,o=t[n].color;o[0]>251&&o[1]>251&&o[2]>251&&(t[n].color=[255,255,255])}},{quantize:function(c,h){if(!c.length||h<2||h>256)return new a;var l=function(n){var e,o,u,s,a=new Array(1<<3*t);return n.forEach(function(t){o=t[0]>>r,u=t[1]>>r,s=t[2]>>r,e=i(o,u,s),a[e]=(a[e]||0)+1}),a}(c);l.forEach(function(){0});var v=function(t,n){var e,o,i,u=1e6,a=0,f=1e6,c=0,h=1e6,l=0;return t.forEach(function(t){e=t[0]>>r,o=t[1]>>r,i=t[2]>>r,e<u?u=e:e>a&&(a=e),o<f?f=o:o>c&&(c=o),i<h?h=i:i>l&&(l=i)}),new s(u,a,f,c,h,l,n)}(c,l),p=new u(function(t,r){return e.naturalOrder(t.count(),r.count())});function g(t,r){for(var e,o=1,i=0;i<n;)if((e=t.pop()).count()){var u=f(l,e),s=u[0],a=u[1];if(!s)return;if(t.push(s),a&&(t.push(a),o++),o>=r)return;if(i++>n)return}else t.push(e),i++}p.push(v),g(p,o*h);for(var b=new u(function(t,r){return e.naturalOrder(t.count()*t.volume(),r.count()*r.volume())});p.size();)b.push(p.pop());g(b,h-b.size());for(var d=new a;b.size();)d.push(b.pop());return d}}}();t.exports=n},function(t,r,n){"use strict";n.r(r);var e=n(0),o=n.n(e);addEventListener("message",function(t){postMessage((new o.a).getPaletteFromPixels(t.data.pixels,t.data.pixelCount))})}]);